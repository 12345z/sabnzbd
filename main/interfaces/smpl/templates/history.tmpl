<h3>History <a id="feed" href="rss?mode=history"><img id="rss" src="static/feed-icon-14x14.png" alt="rss"/></a></h3>
<div id="centerLinks">
<a onClick="lr('history/purge', '', '-1',-1,this.parentNode.parentNode.id);">Purge history</a> | <a onClick="lr('history/tog_verbose', '', -1,-1,this.parentNode.parentNode.id);"><!--#if $isverbose then "Hide details" else "Show details"#--></a></span>
</div>    
History Size: $total_size
<% import datetime %>

<!--#if $lines#-->
<table id="historyTable">
<tr>
<th class="expandColumn"></th>
<th>Name</th>
<th class="linksColumn">Links</th>
<th class="sizeColumn">Size</th>
<th class="statusColumn">Status</th>
<th class="actionsColumn"></th>
</tr>
    <!--#for $line in $lines #-->
    <tbody id="$line.nzo_id">
    <tr>
        <td class="center"><a id="tog_$line.nzo_id" class="expander" onclick="javascript:toggleHistoryDetails('$line.nzo_id', 'row_$line.nzo_id', 'tog_$line.nzo_id')">
        <!--#if $line.show_details then '-' else '+'#-->
        </a></td>
        <td>$line.name<!--#if $line.action_line#--> - $line.action_line<!--#else if $line.fail_message#--> - <span class="fail_message">$line.fail_message</span><!--#end if#--></td>
        <td>
            <!--#if $line.url_info#-->
                <a href="$line.url_info"><img class="imglink" src="static/images/browser.png" /></a>
            <!--#end if#-->
            <!--#if $line.report#-->
                <a href="https://www.newzbin.com/browse/post/$line.report"><img class="imglink" src="static/images/newzbin.png" /></a>
            <!--#end if#-->
        </td>
        <td>$line.size</td>
        <td>$line.status</td>
        <td class="right_align"><a onClick="deletehistoryitem('$line.nzo_id', this.parentNode.parentNode.parentNode.parentNode.parentNode.id);"><img class="delicon" src="static/images/messagebox_critical.png" /></a></td>
    </tr>
    
    <tr id="row_$line.nzo_id" <!--#if $line.show_details then 'style="display:table-row;"' else 'class="hidden"'#-->>
        <td></td>
        <td colspan="5">
        <% 
d = datetime.datetime.fromtimestamp(float(line['completed']))
t = "%s:%s" % (str(d.hour).rjust(2,'0'), str(d.minute).rjust(2,'0'))
        %>
        <div class="left-margin line-height">
            Completed at $t
            <br />
            <!--#for $stage in $line.stage_log#-->
                <span class="bold">$stage.name.title: </span><br />
                <!--#for $item in $stage.actions #-->
                    <span class="left-margin">$item</span><br />
                <!--#end for#-->
            <!--#end for#-->
            <!--#if $line.category#-->
                <span class="bold">Category: </span><br />
                <span class="left-margin">$line.category</span><br />
            <!--#end if#-->
            <!--#if $line.path#-->
                <span class="bold">Path: </span><br />
                <span class="left-margin" title="$line.storage">$line.path</span>
            <!--#end if#-->
            <br />

            </div>
        </td>
    </tr>
    </tbody>
    <!--#end for#-->
<!--#end if#-->
</table>

