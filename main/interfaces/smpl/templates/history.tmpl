<h3>History <a id="feed" href="rss?mode=history"><img id="rss" src="static/feed-icon-14x14.png" alt="rss"/></a></h3>
<div class="searchBox">
    <input id="historySearch" type="text" size="17" name="search" value="$search" onchange="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=0', 1, this.parentNode.parentNode.id, 1);" onfocus="pauseHistoryDeferer(this.parentNode.parentNode.id)" onblur="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=0',1, this.parentNode.parentNode.id, 1);">
    <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=0',1, this.parentNode.parentNode.id);"><img class="delicon" src="static/images/key_enter.png" /></a>
    <a onclick="javascript:loadSearch('history', '', 'limit=$limit&start=$0',1, this.parentNode.parentNode.id);"><img class="delicon" src="static/images/messagebox_critical.png" /></a>
</div>
<div class="centerLinks">
    <a onClick="if(confirm('Delete the all items from the history?')){javascript:loadSearch('history/purge', 'historySearch', 'limit=$limit&start=0', -1,this.parentNode.parentNode.id);}">Purge history</a> | 
	<a onClick="if(confirm('Delete the all failed items from the history?')){javascript:loadSearch('history/purge_failed', 'historySearch', 'limit=$limit&start=0', -1,this.parentNode.parentNode.id);}">Purge failed items</a> | 
	<a onClick="javascript:loadSearch('history/tog_verbose', 'historySearch', 'limit=$limit&start=0', -1,this.parentNode.parentNode.id);"><!--#if $isverbose then "Hide details" else "Show details"#--></a></span>
</div>   
History Size: $total_size
<% import datetime %>

<!--#if $lines#-->
<table id="historyTable">
<tr>
<th class="expandColumn"></th>
<th>Name</th>
<th class="linksColumn">Links</th>
<th class="sizeColumn">Size</th>
<th class="statusColumn">Status</th>
<th class="actionsColumn"></th>
</tr>
    <!--#for $line in $lines #-->
    <tbody id="$line.nzo_id">
    <tr>
        <td class="center"><a id="tog_$line.nzo_id" class="expander" onclick="javascript:loadSearch('history/tog_verbose', 'historySearch', 'jobs=$line.nzo_id&limit=$limit&start=0',-1, this.parentNode.parentNode.parentNode.parentNode.parentNode.id);">
        <!--#if $line.show_details then '-' else '+'#-->
        </a></td>
        <td>$line.name<!--#if $line.action_line#--> - <span class="action_message">$line.action_line</span><!--#else if $line.fail_message#--> - <span class="fail_message">$line.fail_message</span><!--#end if#--></td>
        <td>
            <!--#if $line.report#-->
                <a href="https://www.newzbin.com/browse/post/$line.report"><img class="imglink" src="static/images/newzbin.png" /></a>
            <!--#end if#-->
            <!--#if $line.url_info#-->
                <a href="$line.url_info"><img class="imglink" src="static/images/browser.png" /></a>
            <!--#end if#-->
        </td>
        <td>$line.size</td>
        <td>$line.status</td>
        <td class="right_align"><!--#if not $line.loaded#--><a onClick="deletehistoryitem('$line.nzo_id', this.parentNode.parentNode.parentNode.parentNode.parentNode.id);"><img class="delicon" src="static/images/messagebox_critical.png" /></a><!--#else#--> <!--#end if#--></td>
    </tr>
    <!--#if $line.show_details#-->
    <tr id="row_$line.nzo_id">
        <td></td>
        <td colspan="5">
        <% 
d = datetime.datetime.fromtimestamp(float(line['completed']))
t = "%s:%s" % (str(d.hour).rjust(2,'0'), str(d.minute).rjust(2,'0'))
        %>
        <div class="left-margin line-height">
            Completed at $t
            <br />
            <!--#for $stage in $line.stage_log#-->
                <span class="bold">$stage.name.title: </span><br />
                <!--#for $item in $stage.actions #-->
                    <span class="left-margin">$item</span><br />
                <!--#end for#-->
            <!--#end for#-->
            <!--#if $line.category#-->
                <span class="bold">Category: </span><br />
                <span class="left-margin">$line.category</span><br />
            <!--#end if#-->
            <!--#if $line.storage#-->
                <span class="bold">Path: </span><br />
                <span class="left-margin">$line.storage</span>
            <!--#end if#-->
            <br />

            </div>
        </td>
    </tr>
	<!--#end if#-->
    </tbody>
    <!--#end for#-->
<!--#end if#-->
</table>

<br />
<!--#if $finish == 1#-->
Showing 1 result
<!--#else#-->

Showing <!--#if $finish > 0 then $start+1 else '0'#--> to $finish out of $noofslots results
<!--#end if#-->
<br />
<div class="centerLinks">
    <!--#if $limit and $noofslots#-->
        <!--#set $total = $noofslots#-->
        <!--#while ($total % $limit)#-->
            <!--#set $total = $total+1#-->
        <!--#end while#-->
        <!--#set $pages = ($total / $limit)#-->
        <!--#set $newfinish = $finish#-->
        <!--#while ($newfinish % $limit)#-->
            <!--#set $newfinish = $newfinish+1#-->
        <!--#end while#-->
        <!--#set $currentpage = int($newfinish / $limit)#-->
        <!--#set $offset = 0#-->
        <!--#if $currentpage == 1#-->
            &laquo;First 
            &lsaquo;Prev 
        <!--#else#-->
            <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=0', 1,this.parentNode.parentNode.id);">&laquo;First</a> 
            <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=<!--#echo $start-$limit#-->', 1,this.parentNode.parentNode.id);">&lsaquo;Prev</a> 
        <!--#end if#-->
        <!--#for $i in $range($pages)#-->
            <!--#if  $currentpage == $i+1#-->
                <!--#echo $i+1#-->
            <!--#else#-->
                <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=$offset', 1,this.parentNode.parentNode.id);"><!--#echo $i+1#--></a>
            <!--#end if#-->
            <!--#set $offset = $offset + $limit#-->
        <!--#end for#-->
        <!--#if $currentpage == $pages#-->
            Next&rsaquo; Last&raquo;
        <!--#else#-->
            <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=<!--#echo $start+$limit#-->', 1,this.parentNode.parentNode.id);">Next&rsaquo;</a> 
            <a onclick="javascript:loadSearch('history', 'historySearch', 'limit=$limit&start=<!--#echo (($pages-1)*$limit)#-->', 1,this.parentNode.parentNode.id);">Last&raquo;</a>
        <!--#end if#-->
    <!--#end if#-->
</div>

