<%
def InjectProgressBarPosition (mbleft, mb):
	if mb == '0.00': # don't divide by zero
		return '-120px -1px;'
	percentage = int(100 - float(mbleft) / float(mb) * 100)
	postion =  int(120 - 120.0 / 100.0 * percentage)
	return '-'+str(postion)+'px -1px;'
%>

<script type="text/javascript">
	
	\$('#stats_kbpersec').html('<!--#echo "%.0f" % float($kbpersec)#-->');
	\$('#stats_eta').html('$timeleft');
	\$('#stats_eta').attr('title','ETA: $eta');
	
	if (\$("#maxSpeed-option").val() != '$speedlimit' && !focusedOnSpeedChanger)
		\$("#maxSpeed-option").val('$speedlimit');
	if (\$("#onQueueFinish-option").val() != '$finishaction')
		\$("#onQueueFinish-option").val('$finishaction');
	
	var paused = <!--#if $paused#-->true<!--#else#-->false<!--#end if#-->;
	if ( paused && \$('#pause_resume').attr('class') != 'tip q_menu_pause q_menu_paused')
		\$('#pause_resume').attr('class','tip q_menu_pause q_menu_paused');
	else if ( !paused && \$('#pause_resume').attr('class') != 'tip q_menu_pause q_menu_unpaused')
		\$('#pause_resume').attr('class','tip q_menu_pause q_menu_unpaused');
	
	<!--#if $noofslots < 1#-->
	document.title = '<!--#if $paused#-->PAUSED<!--#else#-->READY<!--#end if#--> | SABnzbd+ Plush';
	<!--#else if $paused#-->
	document.title = 'PAUSED | <!--#echo "%.0f" % float($mbleft)#--> MB left | $noofslots NZBs';
	<!--#else#-->
	document.title = '<!--#echo "%.0f" % float($kbpersec)#--> kB/s | <!--#echo "%.0f" % float($mbleft)#--> MB | $timeleft left';
	<!--#end if#-->
	
</script>

<div class="box_banner_hr"></div>

<span id="stats_noofslots">$noofslots</span>

<table class="queueTable" id="queueTable">
<!--#set $odd = False#-->
<!--#if $varExists('slotinfo')#-->
<!--#for $slot in $slotinfo#-->
	<!--#set $odd = not $odd#-->
	<tr id="$slot.nzo_id"<!--#if $odd#--> class="alt"<!--#end if#-->>
	
	<td title="Average File Age: $slot.avg_age" class="download-title">
		<div class="title"></div>
		<a href="queue/$slot.nzo_id/">$slot.filename</a>
	</td>
	
	<td class="queueProgressBarContainer">
		<div class="queueProgressBar" style="background-position: <%=InjectProgressBarPosition(slot['mbleft'],slot['mb'])%>">
			<div class="totalDownload"><%=int(float(slot['mbleft']))%>&nbsp;<small>left</small></div>
			<div class="currentDownload"><%=int(float(slot['mb']))%>&nbsp;<small>MB</small></div>
		</div>
	</td>
	
	<td class="eta">
		<!--#if not $paused#-->
		$slot.timeleft&nbsp;left<br/>$slot.eta
		<!--#else#-->
		&nbsp;<br/>&nbsp;
		<!--#end if#-->
	</td>
	
	<td class="options">
		<div class="queue_delete" title="Remove&nbsp;NZB">&nbsp;&nbsp;&nbsp;</div>
		<!--#if $cat_list#-->
		<select title="Category" class="proc_category">
			<!--#for $ct in $cat_list#-->
			<option value="$ct" <!--#if $slot.cat.lower() == $ct.lower() then "selected" else ""#-->>$ct</option>
			<!--#end for#-->
		</select>
		<!--#end if#-->
		<select title="Processing Option" class="proc_option">
			<option value="0" <!--#if $slot.unpackopts == "0" then "selected " else ""#-->>(Skip)</option>
			<option value="1" <!--#if $slot.unpackopts == "1" then "selected " else ""#-->>+Repair</option>
			<option value="2" <!--#if $slot.unpackopts == "2" then "selected " else ""#-->>+R+Unpack</option>
			<option value="3" <!--#if $slot.unpackopts == "3" then "selected " else ""#-->>+R+U+Delete</option>
		</select>
		<!--#if $script_list#-->
		<select title="Script" class="proc_script">
			<!--#for $sc in $script_list#-->
			<option value="$sc"  <!--#if $slot.script == $sc then "selected" else ""#-->>$sc</option>
			<!--#end for#-->
		</select>
		<!--#end if#-->
	</td>
	
	</tr>
<!--#end for#-->
<!--#end if#-->
</table>

<div class="box_fatbottom">
	
	<div class="right_stats">
		<!--#if $diskspace1 == $diskspace2#-->
		<strong class="<!--#if float($diskspace1) < float($mb)/1024 #-->stats_incomplete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_incomplete_freespace<!--#end if#-->">$diskspace1&nbsp;GB</strong>&nbsp;Free&nbsp;Space</small></span>
		<!--#else#-->
		<strong class="<!--#if float($diskspace1) < float($mb)/1024 #-->stats_incomplete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_incomplete_freespace<!--#end if#-->">$diskspace1&nbsp;GB</strong>&nbsp;Free
		<strong class="<!--#if float($diskspace2) < float($mb)/1024 #-->stats_complete_freespace_needspace" title="Not enough disk space to complete downloads!<!--#else#-->stats_complete_freespace<!--#end if#-->">$diskspace2&nbsp;GB</strong>&nbsp;Free&nbsp;Space
		<!--#end if#-->
	</div>
	
	<div class="left_stats">
		<!--#if $varExists('slotinfo')#-->
		<strong>$mbleft&nbsp;of&nbsp;$mb&nbsp;MB</strong>&nbsp;Remaining
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span id="skipped_refresh" style="display:none;">&raquo;&nbsp;Skipped&nbsp;last&nbsp;refresh</span>
		<!--#else#-->
		No pending downloads
		<!--#end if#-->
	</div>
	
</div>
